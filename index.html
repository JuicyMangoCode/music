<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>ðŸŽµ MangoDev Music Host</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			background: #1e1e1e;
			color: #f0f0f0;
			padding: 20px;
			max-width: 800px;
			margin: auto;
		}
		h1 {
			color: #ffcc00;
			text-align: center;
		}
		.search {
			margin-bottom: 20px;
			text-align: center;
		}
		input[type="text"] {
			padding: 10px;
			width: 100%;
			max-width: 400px;
			border: none;
			border-radius: 4px;
			font-size: 16px;
		}
		.file-entry {
			background: #2e2e2e;
			padding: 10px;
			border-radius: 5px;
			margin: 10px 0;
			display: flex;
			flex-direction: column;
			gap: 5px;
		}
		.file-name {
			font-weight: bold;
		}
		.buttons {
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
		}
		button {
			background: #444;
			color: white;
			border: none;
			padding: 5px 10px;
			border-radius: 3px;
			cursor: pointer;
		}
		button:hover {
			background: #666;
		}
		footer {
			margin-top: 40px;
			text-align: center;
			color: #777;
		}
	</style>
</head>
<body>
	<h1>ðŸŽµ MangoDev Music Host</h1>
	<div class="search">
		<input type="text" id="searchBox" placeholder="Search music..." />
	</div>
	<div id="music-list">Loading...</div>
	<footer>
		&copy; 2025 <a href="https://mangodev.site" style="color:#ffcc00;">MangoDev</a>
	</footer>

	<script>
		const apiUrl =
			'https://api.github.com/repos/JuicyMangoCode/music/contents/music_assets';
		const baseRawUrl =
			'https://raw.githubusercontent.com/JuicyMangoCode/music/main/music_assets/';
		const directoriesJsonUrl =
			'https://juicymangocode.github.io/music/directories.json';

		let allFiles = [];
		let shortenedLinks = {};

		function displayFiles(files) {
			const container = document.getElementById('music-list');
			container.innerHTML = '';

			if (files.length === 0) {
				container.textContent = 'No matching files found.';
				return;
			}

			files.forEach((file) => {
				const entry = document.createElement('div');
				entry.className = 'file-entry';

				const fileName = atob(file.name.split('.mp3')[0]);
				const fullUrl = `${baseRawUrl}${file.name}`;
				const shortUrl =
					shortenedLinks[file.name]?.short_url || 'Not Found!';

				entry.innerHTML = `
					<div class="file-name">${fileName}</div>
					<div class="buttons">
						<button onclick="window.open('${fullUrl}', '_blank')">ðŸŽ§ Open</button>
						<button onclick="copyToClipboard('${fullUrl}')">ðŸ”— Copy Full URL</button>
						<button onclick="copyToClipboard('${shortUrl}')">ðŸ“‹ Copy Shortened</button>
					</div>
				`;

				container.appendChild(entry);
			});
		}

		function copyToClipboard(text) {
			navigator.clipboard.writeText(text).then(
				() => alert('Copied!'),
				(err) => alert('Failed to copy.')
			);
		}

		document.getElementById('searchBox').addEventListener('input', (e) => {
			const searchTerm = e.target.value.toLowerCase();
			const filtered = allFiles.filter((file) =>
				atob(file.name.split('.mp3')[0])
					.toLowerCase()
					.includes(searchTerm)
			);
			displayFiles(filtered);
		});

		// Fetch both the file list and the shortened URL mapping
		Promise.all([
			fetch(apiUrl).then((res) => res.json()),
			fetch(directoriesJsonUrl).then((res) => res.json()),
		])
			.then(([fileData, shortLinkData]) => {
				allFiles = fileData.filter((f) => f.name.toLowerCase().endsWith('.mp3'));
				shortenedLinks = shortLinkData;
				displayFiles(allFiles);
			})
			.catch((err) => {
				console.error('Failed to load data:', err);
				document.getElementById('music-list').textContent =
					'Failed to load file list or shortened URLs.';
			});
	</script>
</body>
</html>
